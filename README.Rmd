---
output: rmarkdown::github_document
---
```{r include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```
# roto.athena

Access Amazon's AWS Athena API

## Description

Reticulated wrapper for the Python 'boto3' Athena client library.

## NOTE

This package **requires** Python >= 3.5 to be available and the `boto3` Python package.

## What's Inside The Tin

The following functions are implemented:

- `create_named_query`:	Create a named query.
- `delete_named_query`:	Delete a named query.
- `get_named_query`:	Get Query Execution
- `get_named_queries`:	Get Query Execution (batch/multiple)
- `get_query_execution`:	Get Query Execution
- `get_query_executions`:	Get Query Executions (batch/multiple)
- `get_query_results`:	Get Query Results
- `list_named_queries`:	List Named Queries
- `list_query_executions`:	List Query Executions
- `start_query_execution`:	Start Query Execution
- `stop_query_execution`:	Stop Query Execution

## Installation

```{r eval=FALSE}
devtools::install_github("hrbrmstr/roto.athena")
```

```{r message=FALSE, warning=FALSE, error=FALSE, include=FALSE}
options(width=120)
```

## Usage

```{r message=FALSE, warning=FALSE, error=FALSE}
library(roto.athena)
library(tidyverse)

# current verison
packageVersion("aws.athena")

```

```{r}
# see recent queries
x <- list_query_executions(profile = "personal")

head(x$QueryExecutionIds)

# get last 5 query executions
y <- get_query_executions(x$QueryExecutionIds[1:5], profile = "personal")

# only look at the ones that succeeded
filter(y$QueryExecutions, state == "SUCCEEDED") 

# fire off another one!
start_query_execution(
  query = "SELECT * FROM elb_logs LIMIT 100",
  database = "sampledb",
  output_location = "s3://aws-athena-query-results-redacted",
  profile = "personal"
) -> sqe

```

```{r echo=FALSE}
Sys.sleep(2)
```

```{r}
# see the status
get_query_execution(sqe, profile = "personal") %>% 
  glimpse()

# get the results
res <- get_query_results(sqe, profile = "personal")

res
```
